import webbrowser
import time
import pyperclip
import tkinter
import pyautogui
import subprocess
import sys
import os
import pywinauto
from pynput.keyboard import Key, Controller

# pyinstaller -w -F -i "C:\Users\Chw\Desktop\PROG\web coding\playin\boty\launcher\bloon.ico" launcher.py

botCode = 'bot&&bot.stop();{const t=(t,e=null,n=null)=>{e&&(t.id=controllerId),n&&t.classList.add(...n)},e=(t,e)=>{const n=t.classList.contains(\"btn-on\");return t.classList.toggle(\"btn-on\"),bot.text[e](n),n},n=(t,e,n)=>{var i=new Blob([t],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,e);else{var s=document.createElement(\"a\"),o=URL.createObjectURL(i);s.href=o,s.download=e,document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(o)},0)}},i=document.createElement(\"span\");i.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path d=\"M18 14.45v6.55h-16v-12h6.743l1.978-2h-10.721v16h20v-10.573l-2 2.023zm1.473-10.615l1.707 1.707-9.281 9.378-2.23.472.512-2.169 9.292-9.388zm-.008-2.835l-11.104 11.216-1.361 5.784 5.898-1.248 11.103-11.218-4.536-4.534z\"/></svg>\',i.classList.add(\"editBtn\",\"queue-icon\"),i.title=\"Edit message\";const s=document.createElement(\"span\");s.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path d=\"M24 12l-6-5v4h-5v-5h4l-5-6-5 6h4v5h-5v-4l-6 5 6 5v-4h5v5h-4l5 6 5-6h-4v-5h5v4z\"/></svg>\',s.classList.add(\"bot-handle\",\"queue-icon\"),s.title=\"Move message\";const o=document.createElement(\"span\");o.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z\"/></svg>\',o.classList.add(\"bot-remove\",\"queue-icon\"),o.title=\"Delete message\";const a=document.createElement(\"span\");a.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path d=\"M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6 13h-5v5h-2v-5h-5v-2h5v-5h2v5h5v2z\"/></svg>\',a.classList.add(\"bot-temp-apply\"),a.title=\"Apply template\";const l=document.createElement(\"span\");l.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"><path d=\"M12 18c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3z\"/></svg>\',l.classList.add(\"bot-temp-menu\");var bot={version:\"3.0\",botInterval:null,fakeTypeInterval:null,condInterval:null,rate:500,condRate:1e3,isRunning:!1,isAutoNext:!1,isFirstRun:!0,isQueueRunning:!0,isCondsRunning:!0,cp:{btn:\"\",btnAutoNext:\"\",panel:\"\",rateController:\"\",rateText:\"\",listForm:\"\",addToList:\"\",isHidden:!1,position:\"left\",init(){const e=document.querySelector(\"body\"),n=document.querySelector(\"#botPanel\");n&&n.remove();const i=document.querySelector(\"#sortablejs\");i&&i.remove();const s=document.createElement(\"script\");s.id=\"sortablejs\",s.src=\"https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js\",e.appendChild(s);const o=\"https://bloonbot.herokuapp.com/\",r=(t,e)=>msg={ifs:[t],thens:[e]};s.addEventListener(\"load\",()=>{Sortable.create(this.list,{group:\"botQueue\",animation:100,handle:\".bot-handle\",onEnd:t=>{const e=this.list.children,n=[];for(let t=0;t<e.length;t++)kid=e[t],n.push(kid.textContent);bot.text.mutateTextArr(n)}}),Sortable.create(this.condList,{group:\"botConds\",animation:100,handle:\".bot-handle\",onEnd:t=>{const e=this.condList.children,n=[];for(let t=0;t<e.length;t++){const i=e[t].children[0].textContent,s=e[t].children[1].textContent,o=r(i,s);n.push(o)}bot.text.mutateTextArr(n)}})}),this.all=document.createElement(\"div\"),this.all.id=\"bot--all-without-hide-btn\";const d=(t,e,n=\"div\")=>{this[t]=document.createElement(n);for(let n=0;n<e.length;n++){const i=e[n];\"string\"==typeof i?this[t].appendChild(this[i]):this[t].appendChild(i)}return this[t]},h=(t,e,n=\"all\",i=\"div\")=>(this[t]=d(t,e,i),this[n].appendChild(this[t]),this[t]),c=(t=[],e=\"\",n=\"div\")=>{if(el=document.createElement(n),e)if(\"string\"==typeof e)el.appendChild(document.createTextNode(e));else if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t];el.appendChild(n)}else el.appendChild(e);return Array.isArray(t)?el.classList.add(...t):t&&el.classList.add(t),el},p=(t,e,n,i,s=!1,o=!1,a)=>{this[e]=document.createElement(\"input\"),this[e].type=\"checkbox\",this[e].checked=s,this[e].disabled=o,this[e].addEventListener(\"change\",t=>{const e=t.target.checked;bot.text[n](e),a&&a(e)}),h(t,[e],\"all\",\"label\"),this[t].appendChild(document.createTextNode(i))},u=(e,n,i,s,o=\"all\")=>{this[e]=document.createElement(\"button\"),t(this[e],null,i),this[e].appendChild(document.createTextNode(n)),this[e].addEventListener(\"click\",s),\"string\"==typeof o?this[o].appendChild(this[e]):o.appendChild(this[e])},m=(t,e,n=\"none\",i=\"all\",s=\"div\")=>{this[t]=document.createElement(s),this[t].classList.add(...e);const o=document.createTextNode(n);return this[t].appendChild(o),this[i].appendChild(this[t]),this[t]};u(\"hideBtn\",\"HIDE\",[\"bot--btn\",\"bot--hide-btn\"],t=>{this.toggleHide()}),this.panel=document.createElement(\"div\"),this.panel.id=\"botPanel\",this.onOffSwitches=document.createElement(\"div\"),this.onOffSwitches.classList.add(\"onOffSwitches\"),u(\"btn\",\"ON/OFF\",[\"bot--btn\",\"bot--switch\"],t=>{bot.toggle()},\"onOffSwitches\"),u(\"queueBtn\",\"Queue\",[\"bot--btn\",\"btn-on\",\"onOffSpecific\"],t=>{bot.onOffSpecific(\"queue\")},\"onOffSwitches\"),u(\"conditsBtn\",\"Condits\",[\"bot--btn\",\"btn-on\",\"onOffSpecific\"],t=>{bot.onOffSpecific(\"conds\")},\"onOffSwitches\"),this.all.appendChild(this.onOffSwitches),p(\"loopDiv\",\"loopBox\",\"setLoop\",\"Loop/Repeat \",!0),p(\"replyDiv\",\"replyBox\",\"setReply\",\"Reply Mode \",!1,!1,t=>{this.replyAllDiv.classList.toggle(\"unactive\"),this.replyAllBox.disabled=!t}),p(\"replyAllDiv\",\"replyAllBox\",\"setReplyAll\",\"Send whole queue\",!1,!0),t(this.replyAllDiv,null,[\"bot--box-l2\",\"unactive\"]),p(\"randomDiv\",\"randomBox\",\"setRandom\",\"Random\"),p(\"realTypeDiv\",\"realTypeBox\",\"setRealType\",\"Real Typeâ„¢\"),p(\"fakeTypeDiv\",\"fakeTypeBox\",\"setFakeType\",\"Fake Typing\"),((t,e,n,i,s,o,a,l,r,d,c)=>{this[n]=document.createElement(\"span\"),this[n].innerHTML=i,this[s]=document.createElement(\"input\"),this[s].id=o,this[s].type=\"range\",this[s].min=a,this[s].max=l,this[s].value=r,this[s].step=d,this[s].addEventListener(\"input\",c),h(t,[n,s]),this.rate.id=e})(\"rate\",\"bot--rate\",\"rateText\",\'Send once/<span id=\"bot--rate-gauge\">\'+bot.rate+\"ms</span>\",\"rateController\",\"bot--rate-controller\",0,1e4,bot.rate,1,t=>{let e=t.target.value;bot.changeRate(e)}),setTimeout(()=>this.rateGauge=document.querySelector(\"#bot--rate-gauge\"),0),u(\"btnAutoNext\",\"Auto Next\",[\"bot--btn\",\"bot--auto-next\"],t=>{bot.toggleAutoNext()}),this.btnAutoNext.title=\"If enabled, bot will automatically start another chat when other chatter disconnects.\",u(\"conditsSwitch\",\"conditionals >\",[\"bot--condits-switch\",\"bot--btn\"],this.handleConditsSwitch.bind(this)),m(\"beginLabel\",[\"begin-label\"],\"Start chat with: \",\"all\",\"span\"),this.beginInput=document.createElement(\"input\"),this.beginInput.classList.add(\"begin\"),this.beginInput.placeholder=\"Message\",h(\"beginDiv\",[\"beginLabel\",\"beginInput\"]),this.beginDiv.classList.add(\"begin-div\");const g=(t,e,n,i,s,o)=>{this[t]=document.createElement(\"div\"),this[t].classList.add(...e),this[n]=document.createElement(\"select\");for(let t=0;t<i.length;t++){const e=document.createElement(\"option\");e.appendChild(document.createTextNode(i[t])),e.value=i[t],this[n].appendChild(e)}this[t].appendChild(document.createTextNode(s)),this[t].appendChild(this[n]),this[n].addEventListener(\"change\",o)};h(\"tempCondForm\",[\"conditsSwitch\"]),t(this.tempCondForm,null,[\"bot--container\"]),this.condIfInput=document.createElement(\"input\"),this.condIfInput.placeholder=\"can be RegEx (eg. /regex/)\",this.condIfInput.required=!0,this.condIfLabel=document.createTextNode(\"IF: \"),this.condThenInput=document.createElement(\"input\"),this.condThenInput.required=!0,this.condThenLabel=document.createTextNode(\"THEN: \"),g(\"condTemplates\",[\"bot--cond-templates\"],\"selectCondTemplate\",[\"NONE\",\"fake k/m17\"],\"Template \",t=>{bot.text.setTemplate(t.target.value)}),h(\"condTemplatesDiv\",[\"condTemplates\"]),this.condTemplatesDiv.classList.add(\"templates-modes-div\"),h(\"condIfDiv\",[\"condIfLabel\",\"condIfInput\"]),h(\"condThenDiv\",[\"condThenLabel\",\"condThenInput\"]),u(\"removeCondsBtn\",\"X\",[\"bot--btn\"],t=>{bot.text.removeQueue()}),this.removeCondsBtn.type=\"button\",this.removeCondsBtn.title=\"Clear list of conditionals.\";const b=document.createElement(\"input\");b.type=\"submit\",b.classList.add(\"necessary_submit\"),h(\"condControl\",[\"condIfDiv\",\"condThenDiv\",\"removeCondsBtn\",b]),this.condControl.classList.add(\"bot--list-control\"),this.condList=document.createElement(\"div\"),this.condList.classList.add(\"bot--list\"),this.condList.addEventListener(\"mouseup\",t=>{v(t.target)}),h(\"condForm\",[\"condTemplatesDiv\",\"condControl\",\"condList\"],\"all\",\"form\"),this.condForm.classList.add(\"cond-form\",\"unactive-form\"),this.condForm.addEventListener(\"submit\",t=>{t.preventDefault();const e=this.condIfInput.value,n=this.condThenInput.value;bot.text.addMessage(r(e,n)),this.condIfInput.value=this.condThenInput.value=\"\"}),this.addToList=document.createElement(\"input\"),this.addToList.placeholder=\"Add to message queue\",this.addToList.setAttribute(\"style\",\"width: 80%\"),u(\"resetQueueBtn\",\"R\",[\"bot--btn\"],t=>{bot.text.reset()}),this.resetQueueBtn.title=\"Start from first message.\",u(\"removeQueueBtn\",\"X\",[\"bot--btn\"],t=>{bot.text.removeQueue()}),this.removeQueueBtn.id=\"bot--remove-queue\",this.removeQueueBtn.title=\"Clear the queue of messages.\",this.upperDiv=document.createElement(\"div\"),this.upperDiv.classList.add(\"bot--list-control\"),this.upperDiv.appendChild(this.addToList),this.upperDiv.appendChild(this.resetQueueBtn),this.upperDiv.appendChild(this.removeQueueBtn),this.list=document.createElement(\"div\"),this.list.classList.add(\"bot--list\");let f=null;e.addEventListener(\"mousedown\",t=>{t.target.classList.contains(\"editInput\")||(t.target.closest(\".editBtn\")||bot.text.updateListItem(f),f&&(bot.text.updateListItem(f),f=null))});const v=t=>{const e=t.closest(\".bot--queue-item\");t.closest(\".editBtn\")?setTimeout(()=>{const n=e.classList.contains(\"bot--cond-item\"),i=e.dataset.id,s=n?bot.text.condArr[i]:bot.text.textArr[i],o=document.createElement(\"form\"),a=document.createElement(\"input\");let l=null,r=null,d=null;n?((r=t.closest(\".if-part\"))?(l=\"ifs\",d=s.ifs):(r=t.closest(\".then-part\"),l=\"thens\",d=s.thens),a.value=d[0]):(r=e,a.value=s),a.classList.add(\"editInput\"),o.appendChild(a),r.innerHTML=\"\",r.appendChild(o),f=i,a.focus(),o.addEventListener(\"submit\",t=>{t.preventDefault();const e=a.value;let o=e;if(n){let t={...s};t[l][0]=e,o=t}bot.text.edit(i,o),f=null})},0):t.closest(\".bot-remove\")&&bot.text.removeMessage(e.dataset.id)};this.list.addEventListener(\"click\",t=>{v(t.target)}),g(\"modes\",[\"bot--modes\"],\"selectMode\",[\"NONE\",\"increment\",\"parrot\"],\"Mode \",t=>{bot.text.setMode(t.target.value)}),g(\"templates\",[\"bot--templates\"],\"select\",[\"NONE\",\"waves\",\"BaÅ‚kanica\"],\"Template \",t=>{bot.text.setTemplate(t.target.value)}),h(\"templatesModesDiv\",[\"modes\",\"templates\"]),this.templatesModesDiv.classList.add(\"templates-modes-div\"),h(\"listForm\",[\"templatesModesDiv\",\"upperDiv\",\"list\"],\"all\",\"form\"),this.listForm.addEventListener(\"submit\",t=>{t.preventDefault();const e=this.addToList.value;bot.text.addMessage(e),this.addToList.value=\"\"});const w=()=>{const t=this.impSeparation.value,e=this.importFile.files,n=this.importInput.value,i=n||e;bot.text.import(t,i)};this.expImp=document.createElement(\"div\"),this.exportDiv=document.createElement(\"div\"),this.importDiv=document.createElement(\"form\"),this.importDiv.classList.add(\"bot--import-div\"),this.importTop=document.createElement(\"div\"),this.importTop.classList.add(\"import-top\"),this.importDiv.addEventListener(\"submit\",t=>{t.preventDefault(),w()}),this.expImp.classList.add(\"bot--expimp\"),u(\"exportBtn\",\"< Export >\",[\"bot--btn\",\"bot--export\"],t=>{const e=this.expName.value;bot.text.export(e)},\"exportDiv\"),this.exportBtn.title=\"Export to file.\",u(\"importBtn\",\"> Import <\",[\"bot--btn\",\"bot--import\"],t=>{},\"importTop\"),this.importBtn.title=\"Import from text or file.\",this.expName=document.createElement(\"input\"),this.expName.placeholder=\"file name\",this.expName.id=\"bot--expName\",this.impSeparation=document.createElement(\"input\"),this.impSeparation.placeholder=\"sep.\",this.impSeparation.id=\"bot--impSep\",this.impSeparation.title=\'(ONLY for importing text) Separation - eg. \",\" will split \"i, like, pepper\" to messages \"i\", \"like\" and \"pepper\"\',this.importFile=document.createElement(\"input\"),this.importFile.classList.add(\"import-file\"),this.importFile.type=\"file\",this.exportDiv.classList.add(\"bot--export-div\"),this.exportDiv.appendChild(this.expName),this.importTop.appendChild(this.impSeparation),this.importTop.appendChild(this.importFile);const x=(t,e=!1)=>{const n=c(\"\",t,\"span\"),i=c(\"\",\"\",\"input\");return i.required=e,{input:i,container:c(\"input-container\",[n,i])}},y=(t,e,n=!1)=>{t.textContent=e,n?t.classList.remove(\"wrong\"):t.classList.add(\"wrong\")};(()=>{const t=x(\"Template name: \",!0),e=c(\"result-msg\"),n=c(\"upload-content\",[t.container,e],\"form\"),i=y.bind(null,e);u(\"uploadBtn\",\"\",[\"bot--btn\",\"icon-btn\",\"upload-btn\"],t=>{R(t,this.uploadWindow,[\".bot-window\",\".template-menu\"])},\"exportDiv\"),this.uploadBtn.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M16 16h-3v5h-2v-5h-3l4-4 4 4zm3.479-5.908c-.212-3.951-3.473-7.092-7.479-7.092s-7.267 3.141-7.479 7.092c-2.57.463-4.521 2.706-4.521 5.408 0 3.037 2.463 5.5 5.5 5.5h3.5v-2h-3.5c-1.93 0-3.5-1.57-3.5-3.5 0-2.797 2.479-3.833 4.433-3.72-.167-4.218 2.208-6.78 5.567-6.78 3.453 0 5.891 2.797 5.567 6.78 1.745-.046 4.433.751 4.433 3.72 0 1.93-1.57 3.5-3.5 3.5h-3.5v2h3.5c3.037 0 5.5-2.463 5.5-5.5 0-2.702-1.951-4.945-4.521-5.408z\"/></svg>\';const s=c(\"top-bar\",\"Upload template\");h(\"uploadWindow\",[s,n],\"uploadBtn\").classList.add(\"upload-window\",\"bot-window\",\"off\"),u(\"closeUpload\",\"X\",[\"bot--btn\"],t=>{this.uploadWindow.classList.add(\"off\")},s),u(\"uploadTemp\",\"Upload\",[\"bot--btn\",\"upload-temp\"],e=>{e.preventDefault();const n=bot.text.packData(),s=t.input.value;if(!s)return i(\"You have to name your template.\");this.uploadTemp.classList.add(\"inactive-btn\"),fetch(o+\"templates\",{method:\"POST\",credentials:\"include\",headers:{\"Content-type\":\"application/json\"},body:JSON.stringify({name:s,template:n})}).then(async t=>{const e=await t.json();this.uploadTemp.classList.remove(\"inactive-btn\"),t.ok?i(\"Template created!\",!0):e&&e.msg?i(e.msg):i(\"Unknown error\")}).catch(t=>{this.uploadTemp.classList.remove(\"inactive-btn\"),i(t)})},n)})(),(()=>{const t=(t=!1)=>{this.searchWindow.classList.contains(\"off\")&&!t||(this.templatesResult.innerHTML=\"\",this.templatesResult.appendChild(c(\"bot-loading\",\"Loading templates...\")),fetch(o+\"templates\").then(t=>{if(t.ok)return t.json();console.log(t)}).then(t=>{this.templatesResult.innerHTML=\"\";const e=document.createDocumentFragment();for(item of t){const t=c(\"template-peek\"),n=c(\"template-name\",\"\",\"span\"),i=item.name;n.textContent=i||\"unknown\";const s=c(\"template-author\",\" by \"+(item.author?item.author.name:\"unknown\"),\"span\");if(item.template){const e=item.template.textArr;let n=e[0];for(let t=1;t<e.length&&!(t>5);t++){n=n+\", \"+e[t]}n=document.createTextNode(n),t.appendChild(n)}const o=c(\"template-top\",[l.cloneNode(!0),n,s,a.cloneNode(!0)]),r=c(\"template\",[o,t]);r.dataset.id=item._id,e.appendChild(r)}this.templatesResult.appendChild(e)}))};u(\"searchBtn\",\"\",[\"bot--btn\",\"icon-btn\",\"search-btn\"],e=>{e.preventDefault(),R(e,this.searchWindow,[\".search-window\",\".template-menu\"],()=>{this.searchWindow.classList.contains(\"off\")&&t(!0)})},\"importTop\"),this.searchBtn.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M23.822 20.88l-6.353-6.354c.93-1.465 1.467-3.2 1.467-5.059.001-5.219-4.247-9.467-9.468-9.467s-9.468 4.248-9.468 9.468c0 5.221 4.247 9.469 9.468 9.469 1.768 0 3.421-.487 4.839-1.333l6.396 6.396 3.119-3.12zm-20.294-11.412c0-3.273 2.665-5.938 5.939-5.938 3.275 0 5.94 2.664 5.94 5.938 0 3.275-2.665 5.939-5.94 5.939-3.274 0-5.939-2.664-5.939-5.939z\"/></svg>\',h(\"topBar\",[]).classList.add(\"top-bar\"),h(\"search\",[],\"topBar\",\"input\").placeholder=\"Search for templates...\",u(\"searchClose\",\"X\",[\"close\",\"bot--btn\"],t=>{this.searchWindow.classList.add(\"off\")},\"topBar\"),h(\"searchWindow\",[\"topBar\"]),h(\"templatesResult\",[],\"searchWindow\"),this.templatesResult.classList.add(\"templates-result\");const n=c(\"bot-loading\",\"Loading templates...\");this.templatesResult.appendChild(n),t(),this.searchWindow.classList.add(\"search-window\",\"bot-window\",\"off\"),this.searchBtn.appendChild(this.searchWindow);const i=c(\"result-msg\"),s=y.bind(null,i);this.templatesResult.addEventListener(\"click\",e=>{const n=e.target.closest(\".template\");if(s(\"\"),n&&n.appendChild(i),!n)return;const a=n.dataset.id;let l;e.target.closest(\".bot-temp-apply\")?fetch(o+\"templates/\"+a).then(async t=>{const e=await t.json();t.ok?(bot.text.import(\"\",e.template,!0),s(\"Template applied!\",!0)):e.msg?s(e.msg):s(\"Cannot apply template - unknown error\")}).catch(t=>{s(t)}):(l=e.target.closest(\".bot-temp-menu\"))&&(e.target.closest(\".template-menu\")?(p(),e.target.classList.contains(\"template-option\")&&fetch(o+\"templates/\"+a,{method:\"DELETE\",credentials:\"include\"}).then(async e=>{const n=await e.json();e.ok?t():n.msg?s(n.msg):s(\"Cannot delete - unknown error\")}).catch(t=>{s(t)})):m(l,a))});let r=\"\",d=\"\";const p=()=>{r&&r.remove()},m=(t,e)=>{p(),e!==d?(deleteOption=c([\"template-option\",\"option-delete\"],\"Delete\"),r=c(\"template-menu\",deleteOption),t.appendChild(r),d=e):d=\"\"};e.addEventListener(\"click\",t=>{r&&(t.target.closest(\".bot-temp-menu\")||t.target.closest(\".template-menu\")||(d=\"\",r.remove()))})})(),this.importDiv.appendChild(this.importTop),this.importInput=document.createElement(\"textarea\"),this.importInput.placeholder=\"Paste or type in some text to import\",this.importDiv.appendChild(this.importInput),this.expImp.appendChild(this.exportDiv),this.expImp.appendChild(this.importDiv),this.all.appendChild(this.expImp),this.panel.appendChild(this.hideBtn),u(\"sideSwitch\",\"<|>\",[\"top-btns\",\"bot--btn\",\"icon-btn\",\"side-switch\"],t=>{this.position=this.panel.classList.toggle(\"right\")},\"panel\"),this.sideSwitch.title=\"Change bot position (left/right)\",this.sideSwitch.innerHTML=\'<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M6 13v4l-6-5 6-5v4h3v2h-3zm9-2v2h3v4l6-5-6-5v4h-3zm-4-6v14h2v-14h-2z\"/></svg>\';(()=>{u(\"userBtn\",\"Sign in/Register\",[\"top-btns\",\"bot--btn\",\"icon-btn\"],t=>{R(t,this[L],\".bot-window\")},\"panel\"),this.userBtn.title=\"Sign in/Register\",this.userBtn.innerHTML=\'<svg xmlns=\"https://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M8 9v-4l8 7-8 7v-4h-8v-6h8zm2-7v2h12v16h-12v2h14v-20h-14z\"/></svg>\';const t=x(\"Login: \",1),e=x(\"Password: \",1);e.input.type=\"password\",u(\"closeSign\",\"X\",[\"bot--btn\"],t=>{this.signWindow.classList.add(\"off\")});const n=c(\"result-msg\"),i=y.bind(null,n),s=c(\"\",[t.container,e.container,n]),a=c([\"sign-title\"],\"Sign in\"),l=c([\"sign-title\",\"active\"],\"Register\"),r=c([\"bot--container\",\"sign-switch\"],[l,a]);let h=\"up\";r.addEventListener(\"click\",t=>{i(\"\"),a.classList.toggle(\"active\"),l.classList.toggle(\"active\"),\"up\"===h?(h=\"in\",this.signBtn.textContent=\"Sign in\"):(h=\"up\",this.signBtn.textContent=\"Register\")});const p=c(\"top-bar\",[r,this.closeSign]);d(\"signWindow\",[p,s]),this.signWindow.classList.add(\"sign-window\",\"bot-window\"),this.signWindow.title=\"\",u(\"signBtn\",\"Register\",[\"bot--btn\",\"sign-btn\"],n=>{const s={login:t.input.value,password:e.input.value};s.login&&s.password?(this.signBtn.classList.add(\"inactive-btn\"),fetch(o+\"users/\"+(\"up\"===h?\"register\":\"signin\"),{method:\"POST\",credentials:\"include\",headers:{\"Content-type\":\"application/json\"},body:JSON.stringify(s)}).then(async t=>{const e=await t.json();t.ok?e.login?this.user.setLoggedState(e.login):i(e.msg,!0):i(e.msg),this.signBtn.classList.remove(\"inactive-btn\")}).catch(t=>{i(t),this.signBtn.classList.remove(\"inactive-btn\")})):i(\"Please fill in fields.\")},this.signWindow),this.userBtn.appendChild(this.signWindow)})();let L=\"signWindow\",C=\"userWindow\";this.user={login:null,setLoggedState:function(t){this.login=t,T()}};const T=()=>{if(this.user.login){k(),C=\"signWindow\",L=\"userWindow\",S(this.user.login),this.userBtn.querySelector(\"svg\").innerHTML=\'<path d=\"M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.753 18.305c-.261-.586-.789-.991-1.871-1.241-2.293-.529-4.428-.993-3.393-2.945 3.145-5.942.833-9.119-2.489-9.119-3.388 0-5.644 3.299-2.489 9.119 1.066 1.964-1.148 2.427-3.393 2.945-1.084.25-1.608.658-1.867 1.246-1.405-1.723-2.251-3.919-2.251-6.31 0-5.514 4.486-10 10-10s10 4.486 10 10c0 2.389-.845 4.583-2.247 6.305z\"/>\'}else{k(),L=\"signWindow\",C=\"userWindow\",S(\"ur not supposed to be here...\"),this.userBtn.querySelector(\"svg\").innerHTML=\'<path d=\"M8 9v-4l8 7-8 7v-4h-8v-6h8zm2-7v2h12v16h-12v2h14v-20h-14z\"/>\'}},k=()=>{this[L].classList.contains(\"off\")||(this[L].classList.add(\"off\"),this[C].classList.remove(\"off\"))},S=t=>{this.loginTitle.innerHTML=\"\",this.loginTitle.appendChild(c(\"\",\"Account: \"+t))};(()=>{fetch(o+\"users/authorize\",{method:\"POST\",credentials:\"include\"}).then(async t=>{const e=await t.json();e&&e.login&&this.user.setLoggedState(e.login)})})(),(()=>{const t=c(\"result-msg\"),e=y.bind(null,t);u(\"closeUser\",\"X\",[\"bot--btn\"],t=>{this.userWindow.classList.add(\"off\")}),h(\"loginTitle\",[]);const n=c(\"top-bar\",[this.loginTitle,this.closeUser]);d(\"userWindow\",[n]),this.userWindow.classList.add(\"sign-window\",\"bot-window\",\"off\"),this.userWindow.title=\"\",u(\"logoutBtn\",\"logout\",[\"bot--btn\",\"sign-btn\"],t=>{this.logoutBtn.classList.add(\"inactive-btn\");fetch(\"https://bloonbot.herokuapp.com/users/logout\",{method:\"POST\",credentials:\"include\"}).then(async t=>{const n=await t.json();t.ok?(e(n.msg,!0),this.user.setLoggedState(null)):e(n.msg),this.logoutBtn.classList.remove(\"inactive-btn\")}).catch(t=>{e(t),this.logoutBtn.classList.remove(\"inactive-btn\")})},this.userWindow),this.userBtn.appendChild(this.userWindow)})();let z=[this.uploadWindow,this.searchWindow];const R=(t,e,n,i=null)=>{if(t.screenX&&((t,e)=>{const n=e=>t.target.closest(e);if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(n(e[t]))return!1}else if(n(e))return!1;return!0})(t,n)){i&&i();const t=z;for(let n=0;n<t.length;n++)t[n]===e||t[n].classList.contains(\"off\")||t[n].classList.add(\"off\");return e!==this[L]&&this[L].classList.add(\"off\"),e.classList.toggle(\"off\")}};m(\"title\",[\"bot--title\"],\"BloonBot v\"+bot.version,\"panel\");const B=c([\"bot--container\"],[this.hideBtn,this.sideSwitch,this.userBtn]),A=c([\"bot--container\"],[B,this.title]);this.panel.appendChild(A),this.panel.appendChild(this.all),e.insertBefore(this.panel,e.firstChild),this.stylize()},handleConditsSwitch(t){this.conditsSwitch.textContent=bot.text.isConditsShown?\"conditionals >\":\"< queue\",e(this.conditsSwitch,\"toggleCondits\"),this.listForm.classList.toggle(\"unactive-form\"),this.condForm.classList.toggle(\"unactive-form\")},toggleHide(){this.isHidden?(this.hideBtn.style.setProperty(\"background\",\"red\"),this.all.style.setProperty(\"display\",\"flex\")):(this.hideBtn.style.setProperty(\"background\",\"green\"),this.all.style.setProperty(\"display\",\"none\")),this.isHidden=!this.isHidden},stylize(){const t=\"\\n                    #botPanel {\\n                        color: white;\\n                        padding: 10px;\\n                        z-index: 1000;\\n                        position: absolute;\\n                        width: 450px;\\n                        background: #000a;\\n                        box-sizing: border-box;\\n                        font-family: roboto, arial;\\n                    }\\n\\n                    #botPanel.right {\\n                        right: 0;\\n                    }\\n\\n                    #botPanel.right .bot-window {\\n                        right: 30px;\\n                        left: initial;\\n                    }\\n\\n                    input, textarea {\\n                        box-sizing: border-box;\\n                    }\\n                    \\n                    #botPanel label *, #botPanel label {\\n                        cursor: pointer;\\n                    }\\n                    \\n                    .top-btns {\\n                        margin-left: 10px;\\n                        fill: white;\\n                    }\\n\\n                    .side-switch {\\n                        padding: 2px !important;\\n                    }\\n\\n                    .sign-window {\\n                        top: 0;\\n                        bottom: initial !important;\\n                    }\\n\\n                    .sign-window .bot--btn {\\n                        margin-top: 10px;\\n                    }\\n\\n                    .sign-title {\\n                        display: flex;\\n                        justify-content: center;\\n                        align-items: center;\\n                        padding: 5px;\\n                        border: 2px solid #aaa;\\n                        color: #aaa;\\n                        cursor: pointer;\\n                    }\\n\\n                    .sign-title.active {\\n                        border: 2px solid white;\\n                        color: white;\\n                    }\\n\\n                    .sign-title:nth-of-type(2) {\\n                        margin-left: 5px;\\n                    }\\n\\n                    .inactive-btn {\\n                        background: #666 !important;\\n                    }\\n\\n                    .inactive-btn::after {\\n                        content: \'...\'\\n                    }\\n\\n                    .input-container {\\n                        display: flex;\\n                        align-items: center;\\n                        justify-content: center;\\n                    }\\n\\n                    .sign-window .input-container {\\n                        margin-top: 5px;\\n                    }\\n\\n                    .input-container input {\\n                        flex: 1;\\n                        margin-left: 5px;\\n                    }\\n\\n                    .result-msg {\\n                        color: #6f6;\\n                        margin-top: 5px;\\n                    }\\n\\n                    .result-msg.wrong {\\n                        color: #f66;\\n                    }\\n\\n                    .form-input-label {\\n                        margin-top: 0 !important;\\n                    }\\n\\n                    .bot--title {\\n                        display: inline-block;\\n                        right: 10px;\\n                        color: #fff8;\\n                        font-weight: bold;\\n                    }\\n\\n                    #bot--all-without-hide-btn {\\n                        display: flex;\\n                        flex-flow: column;\\n                        justify-content: center;\\n                        margin: 10px 0 0;\\n                    }\\n\\n                    .bot--list {\\n                        max-height: 20vh;\\n                        overflow: auto;\\n                    }\\n\\n                    .bot--container {\\n                        display: flex;\\n                        justify-content: space-between;\\n                        align-items: center;\\n                    }\\n\\n                    .bot--queue-item {\\n                        padding: 2px;\\n                        background: #fff9;\\n                        color: black;\\n                        border-top: 1px solid #777;\\n                        max-width: 100%;\\n                        overflow: hidden;\\n                        position: relative;\\n                        text-overflow: ellipsis;\\n                        white-space: nowrap;\\n                    }\\n\\n                    .bot--queue-item.bot--cond-item {\\n                        padding: 0px;\\n                    }\\n\\n                    .bot--list-active-el {\\n                        background: #fffc;\\n                    }\\n\\n                    .bot--list-active-el::after {\\n                        content: \'\';\\n                        position: absolute;\\n                        right: 0;\\n                        top: 0;\\n                        height: 100%;\\n                        width: 25px;\\n                        background-image: url(\\\"data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'64\' height=\'64\' fill=\'%23f55\' viewBox=\'0 0 640 640\' shape-rendering=\'geometricPrecision\' text-rendering=\'geometricPrecision\' image-rendering=\'optimizeQuality\' fill-rule=\'evenodd\' clip-rule=\'evenodd\'%3E%3Cpath d=\'M153.581 320L486.42 640.012V-.012L153.581 320z\'/%3E%3C/svg%3E\\\");\\n                        background-position: left;\\n                    }\\n\\n                    #bot--list-control input, .bot--queue-item {\\n                        font-size: 15px;\\n                    }\\n\\n                    #bot--rate {\\n                        margin: 10px 0;\\n                        color: white;\\n                    }\\n\\n                    #bot--rate-controller {\\n                        cursor: pointer;\\n                        width: 100%;\\n                    }\\n\\n                    #bot--rate-gauge {\\n                        font-weight: bold;\\n                    }\\n\\n                    .onOffSwitches {\\n                        display: flex;\\n                    }\\n\\n                    .onOffSwitches > * {\\n                        flex: 1 0 40px;\\n                    }\\n\\n                    .bot--btn {\\n                        padding: 5px;\\n                        background: red;\\n                        color: white;\\n                        border: 2px solid white;\\n                        cursor: pointer;\\n                        font-weight: bold;\\n                    }\\n\\n                    .bot--switch {\\n                        padding: 10px;\\n                        flex: 3 0 200px;\\n                    }\\n\\n                    .bot--remove-queue {\\n                        padding: 2px 6px;\\n                    }\\n\\n                    .bot--list-control {\\n                        display: flex;\\n                        justify-content: space-between;\\n                        align-items: center;\\n                        margin: 5px 0 5px;\\n                    }\\n\\n                    .bot--expimp {\\n                        margin: 10px 0 5px;\\n                        display: flex;\\n                        justify-content: space-around;\\n                        flex-flow: column;\\n                    }\\n\\n                    .bot--expimp input[type=\'file\']{\\n                        width: 250px;\\n                        margin-left: 10px;\\n                    }\\n\\n                    .import-top {\\n                        display: flex;\\n                        justify-content: space-between;\\n                        align-items: center;\\n                        height: 30px;\\n                        margin-top: 10px;\\n                    }\\n\\n                    .bot--expimp input{\\n                        width: 100%;\\n                    }\\n\\n                    .bot--expimp div {\\n                        margin-top: 10px;\\n                    }\\n\\n                    .bot--import {\\n                        background: #8f8;\\n                        color: #080;\\n                    }\\n\\n                    .bot--export {\\n                        background: #f88;\\n                        color: #800;\\n                    }\\n\\n                    #bot--impSep {\\n                        width: 30px;\\n                    }\\n\\n                    #bot--expName {\\n                        width: 60px;\\n                    }\\n\\n                    .bot--export-div {\\n                        position: relative;\\n                    }\\n\\n                    .upload-btn {\\n                        background: #f88;\\n                        fill: #800;\\n                        position: absolute !important;\\n                        right: 0;\\n                        top: 0;\\n                    }\\n\\n                    .upload-content {\\n                        margin-top: 10px;\\n                    }\\n\\n                    .upload-temp {\\n                        background: #f88;\\n                        color: #800;\\n                        grid-column: 2/4;\\n                        grid-row: end;\\n                        margin-top: 10px;\\n                    }\\n\\n                    .search-btn {\\n                        background: #8f8;\\n                        fill: #080;\\n                    }\\n                    \\n                    .search-window {\\n                        height: 500px;\\n                    }\\n\\n                    .icon-btn {\\n                        width: 30px;\\n                        height: 30px;\\n                        position: relative;\\n                        display: flex;\\n                        justify-content: center;\\n                        align-items: center;\\n                    }\\n\\n                    .icon-btn > svg {\\n                        width: 30px;\\n                    }\\n\\n                    .bot-window {\\n                        position: absolute;\\n                        left: 40px;\\n                        bottom: 30px;\\n                        background: #000c;\\n                        width: 400px;\\n                        cursor: auto;\\n                        padding: 10px;\\n                        font-weight: normal;\\n                    }\\n                    \\n                    .bot-window .top-bar {\\n                        display: flex;\\n                        justify-content: space-between;\\n                        align-items: center;\\n                        font-size: 1.2em;\\n                        font-weight: bold;\\n                    }\\n                    \\n                    .bot-window.off {\\n                        display: none;\\n                        pointer-events: none;\\n                    }\\n                    \\n                    .bot-window .close {\\n                        margin-left: 10px;\\n                    }\\n\\n                    .templates-result {\\n                        overflow: auto;\\n                        height: 90%;\\n                    }\\n                    \\n                    .template {\\n                        background: #4448;\\n                        padding: 5px;\\n                        position: relative;\\n                    }\\n                    \\n                    .template-top {\\n                        margin-top: 0px !important;\\n                    }\\n                    \\n                    .template-name {\\n                        font-weight: bold;\\n                    }\\n\\n                    .template-author {\\n                        color: #888;\\n                    }\\n\\n                    .template-peek {\\n                        color: #bbb;\\n                        white-space: nowrap;\\n                        text-overflow: ellipsis;\\n                        overflow: hidden;\\n                        margin-bottom: 5px;\\n                    }\\n\\n                    .template .result-msg {\\n                        margin-top: 0;\\n                    }\\n\\n                    .bot-temp-apply, .bot-temp-menu {\\n                        fill: white;\\n                        position: absolute;\\n                        cursor: pointer;\\n                    }\\n                    \\n                    .bot-temp-apply {\\n                        margin: 0 5px;\\n                        right: 0;\\n                    }\\n\\n                    .bot-temp-menu {\\n                        left: 0;\\n                    }\\n\\n                    .template-menu {\\n                        width: 100px;\\n                        left: 0;\\n                        top: 10px;\\n                        position: absolute;\\n                        background: #000a;\\n                        z-index: 1;\\n                    }\\n\\n                    .template-option {\\n                        margin: 0 !important;\\n                        padding: 5px 0;\\n                        border-bottom: 1px solid #555;\\n                    }\\n\\n                    textarea {\\n                        width: 100%;\\n                        resize: none;\\n                    }\\n\\n                    .bot--box-l2 {\\n                        margin-left: 20px;\\n                    }\\n\\n                    .bot--box-l3 {\\n                        margin-left: 30px;\\n                    }\\n\\n                    #botPanel label.unactive {\\n                        color: #aaa;\\n                    }\\n\\n                    .bot--condits-switch {\\n                        width: 35%;\\n                        background: #f55 !important;\\n                        margin-top: 10px;\\n                    }\\n\\n                    #botPanel .btn-on {\\n                        background: green;\\n                    }\\n\\n                    .unactive-form {\\n                        display: none;\\n                    }\\n                    \\n                    .cond-form .bot--list-control {\\n                        font-weight: bold;\\n                    }\\n                    \\n                    .cond-form input {\\n                        width: 100%;\\n                    }\\n\\n                    .bot--cond-item {\\n                        display: flex;\\n                    }\\n\\n                    .bot--cond-item > * {\\n                        width: 50%;\\n                        height: 100%;\\n                        overflow: hidden;\\n                        text-overflow: ellipsis;\\n                        white-space: nowrap;\\n                        padding: 2px;\\n                    }\\n\\n                    .then-part {\\n                        background: #f779;\\n                    }\\n\\n                    .necessary_submit {\\n                        display: none;\\n                    }\\n\\n                    .templates-modes-div {\\n                        margin-top: 10px;\\n                        display: flex;\\n                        justify-content: space-between;\\n                    }\\n\\n                    .queue-icon {\\n                        margin-right: 6px;\\n                        cursor: pointer;\\n                    }\\n\\n                    .editInput {\\n                        width: 100%;\\n                        box-sizing: border-box;\\n                    }\\n\\n                    .invalid-item {\\n                        color: white;\\n                        background: #f22;\\n                    }\\n\\n                    .begin-div {\\n                        margin-top: 10px;\\n                    }\\n                \",e=document.createElement(\"style\");e.id=\"botStyle\",e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t));const n=document.querySelector(\"#botStyle\");n&&n.remove(),document.getElementsByTagName(\"head\")[0].appendChild(e)}},text:{textArr:[\"ðŸŽˆ\"],initCondArr:[{ifs:[\"m\"],thens:[\"k\"]}],input:\"\",counter:0,oldCounter:0,msgCounter:0,isLoop:!0,isReply:!1,isReplyAll:!1,isRandom:!1,isRealType:!1,isFakeType:!1,fakeTypeRate:300,initialRate:500,itemPause:800,mode:null,msg:\"\",isConditsShown:!1,counters:[\"counter\",\"oldCounter\"],firstCondSwitch:!0,alreadyUsed:[],timesTrying:0,startChat(){const t=bot.cp.beginInput.value;t&&setTimeout(()=>{this.insertMsg(t),bot.sendMsg()},1e3)},edit(t,e){this.isConditsShown?this.condArr[t]=e:this.textArr[t]=e,this.updateList()},checkCond(){const t=this.getStrangerMsg();if(t){const e=t.trim().toLowerCase();for(let t=0;t<this.condListLength;t++){const n=this.condArr[t];let i=n.ifs[0];const s=n.thens[0];if(/^\\/[\\s\\S]*\\//.test(i))try{const n=i.replace(/^\\/|\\/$/g,\"\"),o=new RegExp(n),a=e.match(o);a&&a.length&&(this.insertMsg(s),bot.sendMsg())}catch(e){console.log(\"Invalid RegEx: \",i,e),this.markInvalid(this.condList.children[t].children[0])}else if(e===(i=i.trim().toLowerCase())){this.insertMsg(s);break}}}},markInvalid(t){t.classList.add(\"invalid-item\")},checkCounters(){for(const t of this.counters)this[t]=this[t]+1>this.listLength?0:this[t]},insert(t=!1){if(0===this.listLength)bot.stop(),alert(\"Empty queue!\");else{if(this.checkCounters(),this.isRandom&&!this.afterRandomChecked)if(t){let t=!0;t:for(let e=0;e<this.listLength;e++){const n=this.textArr[e];for(let i=0;i<this.alreadyUsed.length;i++){if(n!==this.alreadyUsed[i]){this.counter=e,t=!1;break t}}}t&&(this.alreadyUsed=[])}else this.counter=Math.floor(Math.random()*this.listLength);switch(this.mode){case\"parrot\":this.insertMsg(this.getStrangerMsg());break;case\"increment\":this.initialMsg=this.textArr[0],this.msg+=this.initialMsg,this.insertMsg(this.msg),this.msgCounter++;break;default:{const t=this.textArr[this.counter];this.insertFromQueue(t)}}this.isRandom&&(this.afterRandomChecked=!1),this.setActiveListEl()}},setActiveListEl(){this.checkCounters(),this.listLength&&(this.list.children[this.counter].classList.add(\"bot--list-active-el\"),this.oldCounter!==this.counter&&this.list.children[this.oldCounter].classList.remove(\"bot--list-active-el\"),this.oldCounter=this.counter)},insertFromQueue(t){let e=!1;this.isRandom&&!this.isLoop?(this.timesTrying++,this.timesTrying>=4?(this.timesTrying=0,this.alreadyUsed=[],this.insert()):(e=!!this.alreadyUsed.find(e=>t===e))?this.insert():this.insertMsg(t)):this.insertMsg(t),e||(this.isRandom||this.counter++,this.counter+1>this.listLength&&(this.isRandom||(this.counter=0),this.isLoop||bot.stop()),this.alreadyUsed.push(t),this.alreadyUsed.length>=this.listLength&&(this.alreadyUsed=[]))},insertMsg(t){const e=t.split(\"$msg\",2);let n=\"\";n=e.length>1?e[0]+this.getStrangerMsg()+(e[1]?e[1]:\"\"):e[0],this.input.value=n},getStrangerMsg(){const t=bot.log.querySelectorAll(\".log-stranger\");if(t.length){return t[t.length-1].textContent.replace(/Obcy:\\s/,\"\")}return\"\"},setLoop(t){this.isLoop=t},setReply(t){this.isReply=t},setReplyAll(t){this.isReplyAll=t},setRandom(t){this.isRandom=t,t&&(this.list.children[this.counter].classList.remove(\"bot--list-active-el\"),this.counter=Math.floor(Math.random()*this.listLength),this.list.children[this.counter].classList.add(\"bot--list-active-el\"),this.afterRandomChecked=!0)},setRealType(t){this.isRealType=t,t?bot.changeRate(1500,!1,!0):bot.changeRate(this.initialRate)},setFakeType(t){this.isFakeType=t,t||clearInterval(bot.fakeTypeInterval),bot.isRunning&&bot.start()},toggleCondits(t){this.isConditsShown=!t,this.presentArr=t?\"textArr\":\"condArr\",this.presentList=t?\"list\":\"condList\",this.presentListLength=t?\"listLength\":\"condListLength\",this.firstCondSwitch&&(this.updateList(),this.firstCondSwitch=!1)},realTypeSetup(){if(this.isRealType){const t=this.textArr[this.counter].length;bot.changeRate(this.initialRate/10*t+this.itemPause,!0)}},confirmListRemove(){return!(this[this.presentListLength]>1)||confirm(\"This will clear the list of messages. Proceed?\")},setTemplate(t){if(this.confirmListRemove()){let e=\"\";if(this.isConditsShown)switch(t){case\"fake k/m17\":e=[{ifs:[\"m\"],thens:[\"k\"]},{ifs:[\"k\"],thens:[\"m\"]},{ifs:[\"/.*lat.*/\"],thens:[\"17\"]},{ifs:[\"/.*m[\\\\d].*/\"],thens:[\"k17\"]},{ifs:[\"/.*k[\\\\d].*/\"],thens:[\"m17\"]},{ifs:[\"hej\"],thens:[\"hej k\"]},{ifs:[\"/^km.*/\"],thens:[\"k\"]}]}else switch(t){case\"waves\":e=[\"ðŸŽˆ\",\"ðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆðŸŽˆðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆðŸŽˆ\",\"ðŸŽˆðŸŽˆ\",\"ðŸŽˆ\"];break;case\"BaÅ‚kanica\":e=\"BaÅ‚kaÅ„ska w Å¼yÅ‚ach pÅ‚ynie krew,| kobiety, wino, taniec, Å›piew.| Zasady proste w Å¼yciu mam,| nie rÃ³b drugiemu tego-| czego ty nie chcesz sam!| Muzyka, przyjaÅºÅ„, radoÅ›Ä‡, Å›miech.| Å»ycie Å‚atwiejsze staje siÄ™.| PrzynieÅ›cie dla mnie wina dzban,| potem ruszamy razem w tan.| BÄ™dzie! BÄ™dzie zabawa!| BÄ™dzie siÄ™ dziaÅ‚o!| I znowu nocy bÄ™dzie maÅ‚o.| BÄ™dzie gÅ‚oÅ›no, bÄ™dzie radoÅ›nie| ZnÃ³w przetaÅ„czymy razem caÅ‚Ä… noc.| BÄ™dzie! BÄ™dzie zabawa!| BÄ™dzie siÄ™ dziaÅ‚o!| I znowu nocy bÄ™dzie maÅ‚o.| BÄ™dzie gÅ‚oÅ›no, bÄ™dzie radoÅ›nie| ZnÃ³w przetaÅ„czymy razem caÅ‚Ä… noc.| Orkiestra nie oszczÄ™dza siÅ‚| juÅ¼ trochÄ™ im brakuje tchu.| Polejcie wina rÃ³wnieÅ¼ im| znÃ³w na parkiecie bÄ™dzie dym.| BaÅ‚kaÅ„skie rytmy, Polska moc!| ZnÃ³w przetaÅ„czymy caÅ‚Ä… noc.| I jeszcze jeden malutki wina dzban| i znÃ³w ruszymy razem w tan!| BÄ™dzie! BÄ™dzie zabawa!| BÄ™dzie siÄ™ dziaÅ‚o!| I znowu nocy bÄ™dzie maÅ‚o.| BÄ™dzie gÅ‚oÅ›no, bÄ™dzie radoÅ›nie| ZnÃ³w przetaÅ„czymy razem caÅ‚Ä… noc.| BÄ™dzie! BÄ™dzie zabawa!| BÄ™dzie siÄ™ dziaÅ‚o!| I znowu nocy bÄ™dzie maÅ‚o.| BÄ™dzie gÅ‚oÅ›no, bÄ™dzie radoÅ›nie| ZnÃ³w przetaÅ„czymy razem caÅ‚Ä… noc.|\".split(\"|\")}this.mutateTextArr(e)}bot.cp.select.value=\"NONE\"},setMode(t,e=!1){if(\"parrot\"===t){this.mode=\"parrot\";const t=bot.cp.replyBox;t.checked||t.click()}else this.mode=\"NONE\"!==t?t:null;e&&(bot.cp.selectMode.value=t),this.reset()},mutateTextArr(t,e=!1){e?this[\"queue\"===e?\"textArr\":\"condArr\"]=t:this[this.presentArr]=t,this.updateList(e)},addMessage(t){if(t){let e=\"\";e=this.isConditsShown?t:t.replace(/\\s/g,\" \");const n=[...this[this.presentArr],e];this.mutateTextArr(n)}},removeMessage(t){t=parseInt(t),this[this.presentArr].splice(t,1),this.isConditsShown||(0!==this.counter&&t!==this.counter&&t<this.counter?this.counter-=1:t===this.counter&&this.reset()),this.updateList()},removeQueue(){this.confirmListRemove()&&this.mutateTextArr(this.isConditsShown?[...this.initCondArr]:[\"ðŸŽˆ\"])},updateListItem(t){if(this.isConditsShown){const e=this.condList.children[t];if(e){e.innerHTML=\"\";const n=this.createListItem(this[this.presentArr][t]);e.appendChild(n)}}else{const e=this.list.children[t];if(e){e.innerHTML=\"\";const n=this.createListItem(this[this.presentArr][t]);e.appendChild(n)}}},createListItem(t,e=null,n=!1){if(n?\"queue\"!==n:this.isConditsShown){let n=null;\"number\"!=typeof e?n=document.createDocumentFragment():((n=document.createElement(\"div\")).dataset.id=e,n.classList.add(\"bot--queue-item\",\"bot--cond-item\"));const a=document.createElement(\"div\"),l=document.createElement(\"div\");a.classList.add(\"if-part\"),l.classList.add(\"then-part\");const r=s.cloneNode(!0),d=i.cloneNode(!0),h=d.cloneNode(!0),c=o.cloneNode(!0);return a.appendChild(c),a.appendChild(r),a.appendChild(d),l.appendChild(h),a.appendChild(document.createTextNode(t.ifs[0])),l.appendChild(document.createTextNode(t.thens[0])),n.appendChild(a),n.appendChild(l),n}{let n=null;\"number\"!=typeof e?n=document.createDocumentFragment():((n=document.createElement(\"div\")).dataset.id=e,n.classList.add(\"bot--queue-item\"));const a=document.createTextNode(t),l=i.cloneNode(!0),r=s.cloneNode(!0),d=o.cloneNode(!0);return n.appendChild(d),n.appendChild(r),n.appendChild(l),n.appendChild(a),n}},updateList(t=!1){if(t?\"queue\"!==t:this.isConditsShown){this.condList.innerHTML=\"\";const e=document.createDocumentFragment();this.condArr.map((n,i)=>{const s=this.createListItem(n,i,t);e.appendChild(s)}),this.condList.appendChild(e),this.condListLength=this.condArr.length}else{this.list.innerHTML=\"\";const e=document.createDocumentFragment();this.textArr.map((n,i)=>{if(n&&\" \"!==n&&\"\\n\"!==n){const s=this.createListItem(n,parseInt(i),t);e.appendChild(s)}else this.textArr.splice(i,0);this.list.appendChild(e)}),this.listLength=this.textArr.length,this.checkCounters(),this.setActiveListEl()}},reset(){this.isConditsShown||(this.listLength&&(this.checkCounters(),this.list.children[this.counter+1>this.listLength?0:this.counter].classList.remove(\"bot--list-active-el\"),this.list.children[0].classList.add(\"bot--list-active-el\")),this.counter=this.oldCounter=this.msgCounter=0,this.msg=\"\")},packData(){return{settings:{boxes:{isLoop:this.isLoop,isReply:this.isReply,isReplyAll:this.isReplyAll,isRandom:this.isRandom,isRealType:this.isRealType,isFakeType:this.isFakeType},switches:{queue:bot.isQueueRunning,conds:bot.isCondsRunning},rate:bot.rate,mode:this.mode,begin:bot.cp.beginInput.value},textArr:this.textArr,condArr:this.condArr}},export(t){const e=this.packData();n(JSON.stringify(e),(t||this.textArr[0])+\".json\",\"text/plain\")},import(t,e,n=!1){if(\"string\"==typeof e)(e=>{\"\\\\n\"===t&&(t=\"\\n\");const n=e.split(t);this.mutateTextArr(n)})(e);else{const t=t=>{if(!t)return void alert(\"Unable to apply template. Not enough template data.\");this.mutateTextArr(t.textArr,\"queue\"),this.mutateTextArr(t.condArr,\"conds\");const e=Object.keys(t.settings.boxes),n=Object.values(t.settings.boxes),i=bot.cp;for(let t=0;t<e.length;t++){const s=e[t],o=n[t];if(this[s]!==o){i[s.slice(2,3).toLowerCase()+s.slice(3)+\"Box\"].click()}}const s=t.settings.begin;bot.cp.beginInput.value=s||\"\",bot.changeRate(t.settings.rate,!1,!0),this.setMode(t.settings.mode,!0);const o=t.settings.switches;bot.onOffSpecific(\"queue\",o.queue),bot.onOffSpecific(\"conds\",o.conds)};if(n)return void t(e);const o=e=>{const n=e.target.result,i=JSON.parse(n);t(i)};if(!window.FileReader)return alert(\"Your browser is not supported\"),!1;var i=new FileReader;if(e.length){var s=e[0];i.readAsText(s),i.addEventListener(\"load\",o)}else alert(\"Please upload a file or enter some text before continuing\")}},init(){this.input=bot.inp,this.list=bot.cp.list,this.listLength=this.list.length,this.condList=bot.cp.condList,this.initialRate=bot.rate,this.condArr=this.initCondArr,this.presentArr=\"textArr\",this.presentList=\"list\",this.presentListLength=\"listLength\",setTimeout(()=>{this.updateList()},0)}},start(){if(this.stop(),this.cp.btn.style.setProperty(\"background\",\"green\"),this.text.realTypeSetup(),this.isQueueRunning&&this.text.isFakeType){let t=1;this.fakeTypeInterval=setInterval(()=>{++t>3&&(t=1);let e=\"Faking typing.\";switch(t){case 2:e+=\".\";break;case 3:e+=\"..\"}this.text.insertMsg(e)},this.text.fakeTypeRate)}this.botInterval=setInterval(()=>{this.runSetup()},this.rate),this.isRunning=!0},stop(){this.isRunning&&(this.cp.btn.style.setProperty(\"background\",\"red\"),clearInterval(this.botInterval),clearInterval(this.fakeTypeInterval),this.botInterval=0,this.fakeTypeInterval=0,this.isRunning=!1)},isLastMsgStrangers(){const t=this.log.lastChild;return!!t&&t.classList.contains(this.strangerMsgClass)},runSetup(){if(this.isCondsRunning&&(this.text.isReply?this.isLastMsgStrangers()&&this.text.checkCond():this.text.checkCond()),this.isQueueRunning){if(this.text.isReply)try{(this.isLastMsgStrangers()||this.text.isReplyAll&&this.text.counter>0)&&(this.text.insert(),this.sendMsg())}catch(t){}else this.text.insert(),this.sendMsg();this.isFirstRun=!1,this.text.isRealType&&this.start()}},sendMsg(){this.btn.click();const t=document.querySelector(\".sd-interface button\");t&&t.click()},leaveIfDisconnected(){this.btn.classList.contains(\"disabled\")&&this.isAutoNext&&(this.btnEsc.click(),this.text.isRandom||this.text.reset(),this.text.startChat())},toggle(){this.isRunning?this.stop():(this.runSetup(),this.start(),this.isFirstRun=!0)},changeRate(t,e=!1,n=!1){if(this.rate=t,!e){this.text.initialRate=t;const e=this.rate<1e3?Math.floor(this.rate)+\"ms\":(this.rate/1e3).toFixed(1)+\"s\";this.cp.rateGauge.textContent=e}n&&(this.cp.rateController.value=t),this.isRunning&&this.start()},toggleAutoNext(){this.isAutoNext?this.cp.btnAutoNext.style.setProperty(\"background\",\"red\"):this.cp.btnAutoNext.style.setProperty(\"background\",\"green\"),this.isAutoNext=!this.isAutoNext},onOffSpecific(t=\"queue\",e=null){const n=\"queue\"===t?\"queueBtn\":\"conditsBtn\",i=\"queue\"===t?\"isQueueRunning\":\"isCondsRunning\";e!==this[i]&&(this.cp[n].classList.toggle(\"btn-on\"),this[i]=!this[i],this.isRunning&&this.start())},init(t,e=null,n=null,i=null,s=null){this.btn=e?document.querySelector(e):null,this.btnEsc=n?document.querySelector(n):null,this.inp=t?document.querySelector(t):null,this.log=i?document.querySelector(i):null,this.strangerMsgClass=s,setInterval(()=>{this.isRunning&&this.leaveIfDisconnected()},1e3),this.cp.init(),this.text.init()}};window.bot=bot}bot.init(\"#box-interface-input\",\"button.o-any.o-send\",\"button.o-any.o-esc\",\"#log-dynamic\",\"log-stranger\");'

#######################################################################
import tkinter as tk
window = tk.Tk()
keyb = Controller()

import re
# from tqdm import tqdm_gui

# def find_file(root_folder, rex):
#     for root,dirs,files in os.walk(root_folder):
#         for f in files:
#             result = re.search(rex, f)
#             if result:
#                 return os.path.join(root, f)



def find_folder(root_folder, rex):
    # for root,dirs,files in tqdm_gui(os.walk(root_folder), total=):
    for root,dirs,files in os.walk(root_folder): # ,files
        for d in dirs:
            result = re.search(rex, d)
            if result:
                print(result)
                return os.path.join(root, d)

# path = find_folder('C:\\', '^Mozilla Firefox$')
# print(path)

import psutil

def isProcessRunning(processName):
    return processName in (p.name() for p in psutil.process_iter())

# browserPaths = {
#     'firefox': r'C:\Program Files\Mozilla Firefox\firefox.exe',
#     'chrome': r'C:\Program Files (x86)\Google\Chrome\Application\chrome.exe',
#     'chrome2': r'C:\Program Files\Google\Chrome\Application\chrome.exe'
# }

def openTab(browser = 'firefox'):
    if browser == 'firefox':
        path = find_folder('C:\\', '^Mozilla Firefox$')
        fullPath = path + '\\firefox.exe'
        print(fullPath)
        subprocess.call([fullPath, '-new-tab', siteUrl])
    elif browser == 'chrome':
        path = find_folder('C:\\', '^Chrome$')
        subprocess.call([path+'\\chrome.exe', '-new-tab', siteUrl])

    return browser

    
import pygetwindow as gw

def focusWindow(title):
    try:
        browserWindow = gw.getWindowsWithTitle(title)[0]
        browserWindow.activate()
        if not fastMode: time.sleep(0.5)
        browserWindow.maximize()
        if not fastMode: time.sleep(0.5)
        return True
    except:
        return False

#######################################################################

# for i in tqdm_gui(range(100)):
#     time.sleep(0.1)

# zezwalaj na wklejanie do firefoxa
fastMode = True
noInstall = False
fastModeSpeed = 1

if not noInstall:
    from tkinter import messagebox

    website = '6obcy'
    msgWindowsEnabled = True

    window.eval('tk::PlaceWindow %s center' % window.winfo_toplevel())
    window.withdraw()
    def messageWindow(type, title, msg):
        if(msgWindowsEnabled):
            if type == 'error':
                messagebox.showerror(title, msg)
            elif type == 'warning':
                messagebox.showwarning(title, msg)
            else:
                messagebox.showinfo(title, msg)

    sites = {
        '6obcy': 'https://6obcy.org/rozmowa',
        'e-chat.co': 'echaturl',
        'test': 'https://6obcy.org'
    }
    siteUrl = sites.get(website, None)

    firefoxFound = True

    if siteUrl is None:
        messageWindow('error', 'BloonBot launcher', 'No such website available')
    else:
        messageWindow('warning' ,'BloonBot launcher', 'Bot installation works best on Firefox. \n Do not use your mouse after you confirm this window. \n Installing will take about 30 seconds.')
        isFirefoxRunning = isProcessRunning('firefox.exe')
        isChromeRunning = isProcessRunning('chrome.exe')
        if not fastMode: time.sleep(2)

        try:
            if isFirefoxRunning:
                launchedBrowser = openTab('firefox')
            elif isChromeRunning:
                launchedBrowser = openTab('chrome')
            else:
                launchedBrowser = openTab('firefox')
        except:
            try:
                launchedBrowser = openTab('chrome')
            except:
                webbrowser.open_new(siteUrl)
                launchedBrowser = 'chrome'
                # firefoxFound = False
                # messageWindow('error', 'BloonBot launcher', 'Firefox or Chrome can not be found.')
                # sys.exit()
                # webbrowser.open_new(siteUrl)
            firefoxFound = False
            
        if launchedBrowser == 'firefox':
            sleeps = {
                'browserLoad': 7,
                'consoleOpen': 3,
                'paste': 2,
                'codeLaunch': 2,
                'consoleClose': 2,
                'firefoxBeforePasteConfirm': 1,
                'keyPressTime': 0.5
            }
            if not isFirefoxRunning:
                sleeps['browserLoad'] = 10
        else:
            sleeps = {
                'browserLoad': 10,
                'consoleOpen': 7,
                'paste': 3,
                'codeLaunch': 3,
                'consoleClose': 2,
                'keyPressTime': 0.5
            }
            if not isChromeRunning:
                sleeps['browserLoad'] = 14

        if fastMode:
            for k, v in sleeps.items():
                sleeps[k] = fastModeSpeed
                if k == 'keyPressTime':
                    sleeps[k] = 0.1
        
        tooLongWait = False
        i = 0
        while not isProcessRunning(launchedBrowser+'.exe'):
            print(i)
            i+=1
            if(i > 15):
                tooLongWait = True
                break
            time.sleep(1)

        if not tooLongWait: time.sleep(sleeps['browserLoad'])
        # pyautogui.click(500, 400)
        focusWindow(launchedBrowser)
        # time.sleep(sleeps['focus'])
        with keyb.pressed(Key.ctrl):
            with keyb.pressed(Key.shift):
                if launchedBrowser == 'firefox': consoleKey = 'k' # firefox
                else: consoleKey = 'j' #chrome

                keyb.press(consoleKey)
                time.sleep(sleeps['consoleOpen'])
                keyb.release(consoleKey)

        pyperclip.copy(botCode)

        if launchedBrowser == 'firefox':
            time.sleep(sleeps['firefoxBeforePasteConfirm'])
            pyautogui.typewrite('zezwalaj na wklejanie', interval=0.02)
            pyautogui.hotkey('ctrl', 'a')

        time.sleep(sleeps['paste']) # pasting code after console is open
        focusWindow(launchedBrowser)
        keyb.press(Key.ctrl)
        keyb.press('v')
        time.sleep(sleeps['keyPressTime'])
        keyb.release(Key.ctrl)
        keyb.release('v')

        time.sleep(sleeps['codeLaunch']) # pressing enter after pasting code to console
        focusWindow(launchedBrowser)
        keyb.press(Key.enter)
        time.sleep(sleeps['keyPressTime'])
        keyb.release(Key.enter)

        time.sleep(sleeps['consoleClose']) # closing console after pressing enter
        focusWindow(launchedBrowser)
        keyb.press(Key.f12)
        time.sleep(sleeps['keyPressTime'])
        keyb.release(Key.f12)
        if firefoxFound:
            messageWindow('info', 'BloonBot launcher', 'BloonBot has been installed. You can safely use your mouse now.')
        else:
            messageWindow('warning', 'BloonBot launcher', 'Firefox/Chrome not found. If bot is not correctly installed install one of these browsers and try again.')

    window.deiconify()
    window.destroy()
    window.quit()